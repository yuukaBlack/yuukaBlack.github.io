---
title: TypeScript-装饰器
tag: skill
date: 2024-04-02 09:45
---
**装饰器是一种特殊类型的声明，能够被加到类声明、方法、访问符、属性、参数上**

## 一、开启装饰器

```
{
    "compilerOptions": {
        "target": "ES5",
        "experimentalDecorators": true
    }
}
```

## 二、定义与使用

1. 使用：@expression，expression求值后为一个表达式，装饰器在运行时被执行，被装饰的信息会作为参数传入

```
// 定义
function color(value: string) { // 装饰器工厂
	return function(target) { // 返回一个装饰器，会应用到目标对象上
		// 运行时执行
	}
}

// 使用
@color('red')

```

2. 可以使用多个装饰器，同一行 多行都可。多个装饰器，会由上至下的执行装饰器工厂，然后再由下至上的执行装饰器
3. 装饰器不能在 .d.ts 和 任何外部上下文中（例如 declare）

## 三、各个装饰器

*参数a：对于静态成员来说 是类的构造函数，对于实例成员是类的原型对象*

| 装饰器 | 应用于               | 用于监视、修改、替换 | 参数                        | 特殊                                                                              |
| ------ | -------------------- | -------------------- | --------------------------- | --------------------------------------------------------------------------------- |
| 类     | 类构造函数           | 类定义               | 类的构造函数                |                                                                                   |
| 方法   | 方法的属性描述符     | 方法定义             | a、成员名、成员的属性描述符 |                                                                                   |
| 访问器 | 访问器的属性描述符   | 访问器的定义         | a、成员名、成员的属性描述符 | 1. 不能同时装饰一个成员的get 和set<br />2. 成员的所有装饰器应用于他的第一个访问器 |
| 属性   | 属性                 | 属性的定义           | a、成员名                   | 无属性描述符                                                                      |
| 参数   | 类构造函数或方法声明 | 方法的参数           | a、成员名、参数索引         |                                                                                   |

## 四、元数据

`reflect-metadata` 库，通过使用 Reflect API 在运行时 访问和使用ts装饰器 获取到被声明的类、方法、属性等

### 4.1 开启 生成元数据

为带有装饰器的声明 自动生成元数据

```
// tsconfig.json
{
    "compilerOptions": {
        "target": "ES5",
        "experimentalDecorators": true,
        "emitDecoratorMetadata": true
    }
}

// index.js
import 'reflect-metadata'

// 使用Reflect
```

### 4.2 元编程 & 元数据

**什么是元编程？**

通过编写代码来操作、修改代码本身。例如ts装饰器，可以在方法调用时判断参数是否合规


**什么是元数据？**

描述数据的特征、属性、配置、描述等相关信息，比如

1. js中，jsdoc 来描述函数
2. 数据库中 元数据可以描述表结构 字段等
3. ts装饰器中，通过装饰器在运行时添加额外信息，以便在需要时使用
